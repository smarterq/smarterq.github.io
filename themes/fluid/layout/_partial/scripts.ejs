<!-- SCRIPTS -->
<%- js_ex(theme.static_prefix.popper, "popper.min.js") %>
<%- js_ex(theme.static_prefix.bootstrap, "js/bootstrap.min.js") %>
<%- js_ex(theme.static_prefix.mdbootstrap, "js/mdb.min.js") %>
<% if(is_post && theme.fancybox.enable){ %>
  <%- js_ex(theme.static_prefix.fancybox, "jquery.fancybox.min.js") %>
  <script type="text/javascript">
  /* Fancybox */
  var setupFancybox = function () {
    $("#post img:not(.no-zoom img, img[no-zoom])").each(function() {
    var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      $(this).wrap(element);
    });
  };
  setupFancybox();
  </script>
<% } %>
<%- js_ex(theme.static_prefix.internal_js, "main.js") %>
<% if(theme.lazyload.enable){ %>
  <%- js_ex(theme.static_prefix.internal_js, "lazyload.js") %>
<% } %>
<% if(is_post()){ %>
  <% if(theme.post.toc.enable){ %>
    <%- js_ex(theme.static_prefix.tocbot, "/tocbot.min.js") %>
  <% } %>
  <%- js_ex(theme.static_prefix.internal_js, "post.js") %>
<% } %>
<% if(theme.highlight.enable){ %>
  <%- js_ex(theme.static_prefix.prettify, "/prettify.min.js") %>
  <script type="text/javascript">
    $(document).ready(function () {
      $('pre').addClass('prettyprint  <%- config.highlight.line_number ? 'linenums' : '' %>');
      prettyPrint();
    })
  </script>
<% } %>
<% if(theme.fun_features.typing.enable){ %>
  <%- js_ex(theme.static_prefix.typed, "/typed.min.js") %>
  <script type="text/javascript">
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "<%- data.subtitle %>&nbsp;",
      ],
      cursorChar: "<%- theme.fun_features.typing.cursorChar %>",
      typeSpeed: <%- theme.fun_features.typing.typeSpeed %>,
      loop: <%- theme.fun_features.typing.loop %>,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>
<% } %>
<% if(theme.fun_features.anchorjs.enable){ %>
  <%- js_ex(theme.static_prefix.anchor, "/anchor.min.js") %>
  <script type="text/javascript">
    anchors.options = {
      placement: "<%- theme.fun_features.anchorjs.placement %>",
      visible: "<%- theme.fun_features.anchorjs.visible %>",
      <% if(theme.fun_features.anchorjs.icon != ""){ %>
      icon: "<%- theme.fun_features.anchorjs.icon %>"
      <% } %>
    };
    var el = "<%- theme.fun_features.anchorjs.element || 'h1,h2,h3,h4,h5,h6' %>".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>
<% } %>
<% if(theme.search.enable){ %>
  <%- js_ex(theme.static_prefix.internal_js, "local-search.js") %>
  <script type="text/javascript">
    var path = "<%- theme.search.path || '/local-search.xml' %>";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>
<% } %>
<% if (theme.smooth_scroll.enable) { %>
  <%- js_ex(theme.static_prefix.smooth_scroll, "SmoothScroll.min.js") %>
  <style type="text/css">
    html, body{
      scroll-behavior: smooth;
    }
    @media screen and (prefers-reduced-motion: reduce){
      html, body{
        scroll-behavior: auto;
      }
    }
  </style>
<% } %>
<% if(theme.post.math.enable && (!theme.post.math.specific || (theme.post.math.specific && page.math))) { %>
  <% var engine = theme.post.math.engine; %>
  <% if(engine === 'mathjax') { %>
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          tex2jax: {
              inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
              processEscapes: true,
              skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
          }
      });
      MathJax.Hub.Queue(function() {
          var all = MathJax.Hub.getAllJax(), i;
          for(i=0; i < all.length; i += 1) {
              all[i].SourceElement().parentNode.className += ' has-jax';
          }
      });
    </script>
    <%- js_ex(theme.static_prefix.mathjax, "MathJax.js?config=TeX-MML-AM_CHTML") %>
  <% } else if (engine === 'katex') { %>
    <!-- KaTeX -->
    <%- css_ex(theme.static_prefix.katex, "katex.min.css") %>
  <% } %>
<% } %>
<% if(theme.index.post_img.enable && theme.index.post_img.random) { %>
<script type="text/javascript">
  /* 首页文章列表随机图片 */
  $("img.image_random").each(function(){
    <% if(theme.index.post_img.ctype) { %>
      <% if(theme.index.post_img.ctype === "random") { %>
        var ctypeAll = ["acg","nature"];
        var ctype = ctypeAll[Math.floor(Math.random() * ctypeAll.length)];
        var xjhUrl = "//img.xjh.me/random_img.php?return=json&type=bg&ctype=" + ctype;
      <% } else if(theme.index.post_img.ctype === "auto") { %>
        var xjhUrl = "//img.xjh.me/random_img.php?return=json&type=bg;
      <% } else { %>
        var ctype = <%= theme.index.post_img.ctype %>;
        var xjhUrl = "//img.xjh.me/random_img.php?return=json&type=bg&ctype=" + ctype;
      <% } %>
    <% } else { %>
      var xjhUrl = "//img.xjh.me/random_img.php?return=json";
    <% } %>
    var _this = $(this);
    $.get(xjhUrl,function(data,status){
      if(status === "success"){
        if(data.result === 200){
          _this[0].src = data.img;
        }
      }
    });
  });
</script>
<% } %>
<script type="text/javascript">
  /* 切换背景 */
  <% if(theme.full_bg_img) { %>
  $("#background").removeClass("banner-bg");
  $("body").addClass("banner-bg");
  var postToTopHight = $("#board").offset().top;
  $(window).scroll(function () {
    var bgDisplay = false;
    var scrollHeight = document.body.scrollTop + document.documentElement.scrollTop;
    bgDisplay = scrollHeight >= postToTopHight;
    if(bgDisplay) {
      $('#background').removeClass("rgba-black-slight");
      $('#mainContent').removeClass("rgba-black-slight");
      $('#footerContent').removeClass("rgba-black-slight");
    } else {
      $('#background').addClass("rgba-black-slight");
      $('#mainContent').addClass("rgba-black-slight");
      $('#footerContent').addClass("rgba-black-slight");
    }
  });
  <% } else { %>
    $("body").removeClass("banner-bg");
    $("#background").addClass("banner-bg");
    $('#mainContent').removeClass("rgba-black-slight");
    $('#footerContent').removeClass("rgba-black-slight");
    if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent) || (/Safari/i.test(navigator.userAgent) && !/Chrome/i.test(navigator.userAgent))) {
      $("#background").css("background-attachment", "scroll");
    }
  <% } %>
</script>
<% if(theme.footer.date.enable) { %>
<script type="text/javascript">
/*显示博客运行时间*/
var blogRunTime = function () {
  var runTime = document.getElementById("runtime");
  var runtimeDate = "<%- theme.footer.date.create_date %>";
	var createDate = new Date(runtimeDate);
	var nowDate = new Date();
	var dateLine = nowDate.getTime() - createDate.getTime();
	var runDate = Math.floor(dateLine / (1000 * 60 * 60 * 24));
	runTime.innerHTML = runDate;
};
$(document).ready(function(){
	blogRunTime();
});
</script>
<% } %>
<% if(theme.fun_features.monitortext.enable) { %>
<script type="text/javascript">
/*窗口监视*/
var originalTitle = document.title;
window.onblur = function(){document.title = "<%- theme.fun_features.monitortext.text %>"};
window.onfocus = function(){document.title = originalTitle};
</script>
<% } %>
<% if(theme.footer.hitokoto) { %>
<script type="text/javascript">
/*一言API*/
$(document).ready(function(){
  getHitokoto();
});
function hitokoto(e) {
  $("#hitokoto").stop().fadeOut(function() {
    $("#hitokoto").html(e.hitokoto);
    var element = document.getElementById('hitokotoa');
    element.href = "https://hitokoto.cn?id=" + e.id;
    $("#hitokoto").stop().fadeIn()
  })
};
function getHitokoto() {
  var e = ["a", "b", "c", "d"],
  t = document.createElement("script");
  t.type = "text/javascript";
  t.id = "hitokotoko_js";
  t.src = "//v1.hitokoto.cn/?encode=json&callback=hitokoto&charset=utf-8&cat=" + e[Math.floor(Math.random() * e.length)];
  $("#hitokoto").append(t);
};
setInterval(getHitokoto, 1e4);
</script>
<% } %>
<% if(theme.fun_features.snow.enable) { %>
<script type="text/javascript">
/* 雪花效果 */
console.log('雪花效果 code by kvv.me');
~function () {
  function t() {
      e.width = window.innerWidth,
      e.height = window.innerHeight,
      o = Math.round(window.innerWidth * window.innerHeight / 1e4)
  }
  function n() {
      var t = window.innerWidth
        , d = window.innerHeight
        , c = e.getContext("2d");
      c.clearRect(0, 0, t, d),
      c.fillStyle = "<%= theme.fun_features.snow.color %>",
      c.beginPath(),
      a += .01;
      for (var u = 0; o > u; u++) {
        var l = r[u];
        if (!l) {
          continue
        }
        ;c.moveTo(l.x, l.y),
        c.arc(l.x, l.y, l.radius, 0, 2 * Math.PI, !0),
        l.y += Math.cos(a) + l.radius / 2,
        l.x += Math.sin(a * l.direction),
        (l.x > t + 5 || -5 > l.x || l.y > d) && (u % 3 > 0 ? (r[u].x = Math.random() * t,
        r[u].y = -10) : Math.sin(a * l.direction) > 0 ? (r[u].x = -5,
        r[u].y = Math.random() * d) : (r[u].x = t + 5,
        r[u].y = Math.random() * d))
      }
      c.fill(),
      i(n)
  }
  var e = document.createElement("canvas")
    , i = requestAnimationFrame || msRequestAnimationFrame || function(t) {
      setTimeout(t, 16)
    }
  , a = 0
  , o = 0
  , r = [];
  t(),
  e.className = "snow",
  document.body.appendChild(e);
  for (var d = 0; o > d; d++)
    r.push({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        radius: 4 * Math.random() + 1,
        direction: 2 * Math.random() - .5
    });
  addEventListener("resize", t),
  i(n)
}();
</script>
<% } %>